#!/bin/sh
LANG="C"

if [ $# = 0 ]; then
    dpkg-query -W --showformat='${Installed-Size} ${Package}\n'\
        | awk '
            BEGIN{template="%4.2f Mbs\t%s\n"}
            {total += $1}
            NF == 1{printf template, 0, $1}
            NF == 2{printf template, $1/1024, $2}
            END{printf template,total/1024, "TOTALES" }
        ' | sort -n
else
    dpkg-query \
        -W \
        --showformat='${Installed-Size} ${Package}\n' \
        $(apt-cache search $* | awk '{print $1}') 2>/dev/null \
        | awk '
            BEGIN{template="%4.2f Mbs\t%s\n"}
            {total += $1}
            NF == 1{printf  template, 0, $1}
            NF == 2{printf template, $1/1024, $2}
            END{printf template,total/1024, "TOTALES"}
        ' | sort -n
fi
